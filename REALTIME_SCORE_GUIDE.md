# 实时分数功能测试指南

## 功能概述

经典拼图模式现在支持实时分数显示，分数会根据游戏进度动态变化。

## 分数计算规则

### 实时分数公式
```
实时分数 = 基础分数 - 时间惩罚 + 难度奖励 + 放置奖励
```

### 具体计算
- **基础分数**: 1000分
- **时间惩罚**: 每秒扣2分（实时更新）
- **难度奖励**: 简单×100, 中等×200, 困难×300
- **放置奖励**: 每放置一个拼图块加50分

### 颜色指示
- 🟢 **绿色** (≥1200分): 优秀表现
- 🟡 **琥珀色** (800-1199分): 良好表现
- 🟠 **橙色** (400-799分): 一般表现
- 🔴 **红色** (<400分): 需要改进

## 测试步骤

### 1. 启动游戏
```bash
flutter run
```

### 2. 开始经典拼图游戏
- 选择任意难度
- 开始游戏

### 3. 观察实时分数变化

#### 时间影响测试
- 等待几秒钟
- 观察分数逐渐减少（每秒-2分）
- 验证计时器和分数同步更新

#### 放置影响测试
- 拖拽拼图块到正确位置
- 观察分数立即增加（+50分）
- 验证放置奖励实时生效

#### 难度影响测试
- 尝试不同难度级别
- 观察难度奖励差异
- 简单: +100, 中等: +200, 困难: +300

### 4. 游戏完成测试
- 完成整个拼图
- 观察最终分数
- 点击"提交分数"按钮

### 5. 重置测试
- 点击"重新开始"按钮
- 验证分数重置为0
- 验证计时器重置

## 预期行为

### ✅ 正常情况
- 分数每秒更新
- 放置拼图块时分数立即增加
- 分数颜色根据分数段动态变化
- 分数显示带有缩放动画效果

### ✅ 边界情况
- 分数不会低于0分
- 游戏暂停时分数停止更新
- 重置游戏时分数清零

### ✅ 用户体验
- 分数变化直观可见
- 颜色提示分数等级
- 提示信息解释计算规则
- 动画效果增强反馈

## 调试信息

### 控制台输出
```
AuthService: isLoggedIn = true, user = testuser
分数更新: 基础1000 - 时间惩罚20 + 难度奖励200 + 放置奖励150 = 1330
```

### 常见问题

#### 分数不更新
- 检查游戏是否处于进行中状态
- 验证计时器是否正常工作
- 确认状态监听器是否正确设置

#### 分数计算错误
- 检查难度奖励是否正确应用
- 验证放置奖励是否实时计算
- 确认时间惩罚是否每秒更新

#### 颜色不变化
- 检查分数阈值设置
- 验证颜色映射逻辑
- 确认UI更新是否触发

## 性能考虑

### 优化策略
- 实时更新仅在游戏进行中进行
- 使用高效的状态管理
- 避免不必要的UI重绘

### 内存管理
- 正确清理计时器监听器
- 及时释放资源
- 避免内存泄漏

## 扩展功能

### 未来计划
- 添加分数历史记录
- 实现分数预测功能
- 增加分数里程碑奖励
- 添加分数分享功能

## 总结

实时分数功能为经典拼图模式增加了：
- 🎯 **即时反馈**: 玩家可以立即看到操作结果
- 🎮 **沉浸体验**: 分数变化增强游戏乐趣
- 📊 **进度追踪**: 实时了解游戏表现
- 🎨 **视觉反馈**: 颜色和动画增强用户体验

现在玩家可以在游戏过程中实时了解自己的表现，为游戏增添更多乐趣和挑战性！